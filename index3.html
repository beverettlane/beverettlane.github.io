<!DOCTYPE html>
<html>

<head>
    <title>Interactive Filter | CARTO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <script src="https://libs.cartocdn.com/carto-vl/v1.4.4/carto-vl.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css" rel="stylesheet" />
    <link href="https://carto.com/developers/carto-vl/v1.4.4/examples/maps/style.css" rel="stylesheet">

    <style>
        li {
            display: flex;
            align-items: center;
            padding: 8px 0;
        }

        .point-mark {
            margin-right: 4px;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="js-zoom"></div>
    <aside class="toolbox">

<!-- Add legend data -->
    <div class="box">
        <header>
            <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;">Legend</h1>
        </header>
        
        <section>
            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Check boxes to turn layers on and off</p>
        </section>

        <section>
            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Zoom in to click points</p>
        </section>
        
        <footer class="js-footer"></footer>
        
        <section>
            <div class="checkboxes">
                <div>
                    <label style = "font-family: Arial, Helvetica, sans-serif; font-size:16px;">
                        <input type="checkbox" class="radio-checkbox" checked/>
                        <img src='https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009175947Episode.svg' width="15" height="15"> Radio Episodes</img>
                    </label>
                </div>
                
                <div>
                    <label style = "font-family: Arial, Helvetica, sans-serif; font-size:16px;">
                        <input type="checkbox" class="recent-checkbox" checked/>
                        <img src='https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009180505Recent.svg' width="15" height="15"> Recent Episodes</img>
                    </label>
                </div>

                <div>
                    <label style = "font-family: Arial, Helvetica, sans-serif; font-size:16px;">
                        <input type="checkbox" class="article-checkbox" />
                        <img src='https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009193050Article.svg' width="15" height="15"> Article</img>
                    </label>
                </div>

                <div>
                    <label style = "font-family: Arial, Helvetica, sans-serif; font-size:16px;">
                        <input type="checkbox" class="video-checkbox" />
                        <img src='https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009181305Video.svg' width="15" height="15"> Video</img>
                    </label>
                </div>

                <div>
                    <label style = "font-family: Arial, Helvetica, sans-serif; font-size:16px;">
                        <input type="checkbox" class="english-checkbox" />
                        <img src='https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009193553English.svg' width="15" height="15"> English Language Frequencies</img>
                    </label>
                </div>

                <div>
                    <label style = "font-family: Arial, Helvetica, sans-serif; font-size:16px;">
                        <input type="checkbox" class="spanish-checkbox" />
                        <img src='https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009180924Spanish.svg' width="15" height="15" > Spanish Language Frequencies</img>
                    </label>
                </div>
            </div>
        </section>
    </div>
    </aside>

<!-- Set up Loader -->
    <div id="loader">
        <div class="CDB-LoaderIcon CDB-LoaderIcon--big">
          <svg class="CDB-LoaderIcon-spinner" viewBox="0 0 50 50">
            <circle class="CDB-LoaderIcon-path" cx="25" cy="25" r="20" fill="none"></circle>
          </svg>
        </div>
    </div>

<script>

//MAP SETUP

//Add basemap and set properties
    const map = new mapboxgl.Map({
        container: 'map',
        style: carto.basemaps.positron,
        center: [-80, 40],
        zoom: 4
    });

//Listen to every move event caused by the user
    const displayCenter = () => {
        const center = map.getCenter();
        const longitude = center.lng.toFixed(6);
        const latitude = center.lat.toFixed(6);
        const bearing = map.getBearing().toFixed(0);
        const zoom = map.getZoom().toFixed(2);
        console.log(`Center: [${longitude}, ${latitude}] - Zoom: ${zoom} - Bearing: ${bearing} degrees`);
    };
    map.on('move', displayCenter);
    map.off('move', displayCenter);

//Add zoom controls
    const nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'top-left');
    map.addControl(new mapboxgl.FullscreenControl(), 'top-left');

//FUNCTIONS

//Creates loader
    function hideLoader() {
        document.getElementById('loader').style.opacity = '0';
    }

//Creates functional checkboxes
    function handleCheckboxChange() {
        //Find every checkbox and store them in separate variables
            var radioCheckbox = document.querySelector('.radio-checkbox');
            var recentCheckbox = document.querySelector('.recent-checkbox');
            var articleCheckbox = document.querySelector('.article-checkbox');
            var videoCheckbox = document.querySelector('.video-checkbox');
            var englishCheckbox = document.querySelector('.english-checkbox');
            var spanishCheckbox = document.querySelector('.spanish-checkbox');

        //Create an array of all of the values corresponding to checked boxes.
        //If a checkbox is checked, add that filter value to our array.
            var dataType = [];
                if (radioCheckbox.checked) {
                    dataType.push("'radio'");
                }
                if (recentCheckbox.checked) {
                    dataType.push("'recent'");
                }
                if (articleCheckbox.checked) {
                    dataType.push("'article'");
                }
                if (videoCheckbox.checked) {
                    dataType.push("'video'");
                }
                if (englishCheckbox.checked) {
                    dataType.push("'english'");
                }
                if (spanishCheckbox.checked) {
                    dataType.push("'spanish'");
                }
    
        //When checkbox is checked, hide relevant layers while still showing appropriate other layers
            if (radioCheckbox.checked == true) {
                updateZoomEpisodes();
            }
            else {
                episodesLayerC.hide()
                episodesLayerP.hide()
            }
            if (recentCheckbox.checked == true) {
                updateZoomRecent();
            }
            else {
                recentLayerC.hide()
                recentLayerP.hide()
            }
            if (articleCheckbox.checked == true) {
                updateZoomArticle();
            }
            else {
                articleLayerC.hide()
                articleLayerP.hide()
            }
            if (videoCheckbox.checked == true) {
                updateZoomVideo();
            }
            else {
                videoLayerC.hide()
                videoLayerP.hide()
            }
            if (englishCheckbox.checked == true) {
                updateZoomEnglish();
            }
            else {
                englishLayerC.hide()
                englishLayerP.hide()
            }
            if (spanishCheckbox.checked == true) {
                updateZoomSpanish();
            }
            else {
                spanishLayerC.hide()
                spanishLayerP.hide()
            }        
            console.log('Test');
    }

//Creates listeners to checkboxes so handleCheckboxChange() is fired when checkbox is clicked
    var radioCheckbox = document.querySelector('.radio-checkbox');
        radioCheckbox.addEventListener('change', function () {
        handleCheckboxChange();
    });
    var recentCheckbox = document.querySelector('.recent-checkbox');
        recentCheckbox.addEventListener('change', function () {
        handleCheckboxChange();
    });
    var articleCheckbox = document.querySelector('.article-checkbox');
        articleCheckbox.addEventListener('change', function () {
        handleCheckboxChange();
    });
    var videoCheckbox = document.querySelector('.video-checkbox');
        videoCheckbox.addEventListener('change', function () {
        handleCheckboxChange();
    });
    var englishCheckbox = document.querySelector('.english-checkbox');
        englishCheckbox.addEventListener('change', function () {
        handleCheckboxChange();
    });
    var spanishCheckbox = document.querySelector('.spanish-checkbox');
        spanishCheckbox.addEventListener('change', function () {
        handleCheckboxChange();
    });

//Creates Zoom-based layer filter for pop-ups and clustering
    function updateZoomEpisodes() {
        const zoom = map.getZoom().toFixed(2);
            if (map.getZoom().toFixed(2) < 5) {
                episodesLayerC.show()
                episodesLayerP.hide()
            }
            else {
                episodesLayerP.show();
                episodesLayerC.hide()
            }
    }
    function updateZoomRecent() {
        const zoom = map.getZoom().toFixed(2);
            if (map.getZoom().toFixed(2) < 5) {
                recentLayerC.show()
                recentLayerP.hide()
            }
            else {
                recentLayerP.show();
                recentLayerC.hide()
            }
    }   
    function updateZoomArticle() {
        const zoom = map.getZoom().toFixed(2);
            if (map.getZoom().toFixed(2) < 5) {
                articleLayerC.show()
                articleLayerP.hide()
            }
            else {
                articleLayerP.show();
                articleLayerC.hide()
            }
    } 
    function updateZoomVideo() {
        const zoom = map.getZoom().toFixed(2);
            if (map.getZoom().toFixed(2) < 5) {
                videoLayerC.show()
                videoLayerP.hide()
            }
            else {
                videoLayerP.show();
                videoLayerC.hide()
            }
    } 
    function updateZoomEnglish() {
        const zoom = map.getZoom().toFixed(2);
            if (map.getZoom().toFixed(2) < 5) {
                englishLayerC.show()
                englishLayerP.hide()
            }
            else {
                englishLayerP.show();
                englishLayerC.hide()
            }
    } 
    function updateZoomSpanish() {
        const zoom = map.getZoom().toFixed(2);
            if (map.getZoom().toFixed(2) < 5) {
                spanishLayerC.show()
                spanishLayerP.hide()
            }
            else {
                spanishLayerP.show();
                spanishLayerC.hide()
            }
    } 

//Listens to map movements to fire layer selector functions
    // map.on('move', handleCheckboxChange);

//CREATE LAYERS AND POP-UPS

//Defines User
    carto.setDefaultConfig({
        serverURL: 'https://{user}.carto.com'
    });
    carto.setDefaultAuth({
        username: 'yale-climate-connections',
        apiKey: 'FEDSymZNibB5kAz7aosYPw'
    });

//Radio Episodes Layer
    // Define source
        const episodesSource = new carto.source.Dataset('radio_episodes_layer_1');
    
    //Create visualization for clusters layer 
        const episodesVizC = new carto.Viz(`
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: sqrt(clusterCount())*3 + 10
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009180316Episode.svg')
            strokeWidth: 0
            resolution: 32
        `);
    
    //Add cluster layer to map
        const episodesLayerC = new carto.Layer('episodesC', episodesSource, episodesVizC);
        episodesLayerC.on('loaded', hideLoader, function() {
            if (radioCheckbox.checked == false) {
                episodesLayerC.hide();
            }
        });
        episodesLayerC.addTo(map);

    //Create visualization for pop-ups layer
        const episodesVizP = new carto.Viz(`
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009180316Episode.svg')
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: 15
            strokeColor: rgba(0,0,0,0.99)
            resolution: 8
            @currentFeatures: viewportCount()
            @title: $title
            @subtitle: $subtitle
            @link: $link
            @detail: $detail
            @location: $location
        `);
        
    //Add pop-up layer to map
        const episodesLayerP = new carto.Layer('episodesP', episodesSource, episodesVizP);
        episodesLayerP.on('loaded', function() { episodesLayerP.hide();});
        episodesLayerP.addTo(map);

    //Create pop-up
        const episodesinteractivity = new carto.Interactivity(episodesLayerP);
            episodesinteractivity.on('featureClick', featureEvent => {
                featureEvent.features.forEach((feature) => {
                    const title = feature.variables.title.value;
                    const subtitle = feature.variables.subtitle.value;
                    const link = feature.variables.link.value;
                    const detail= feature.variables.detail.value;
                    const location=feature.variables.location.value;
                    console.log(`${title}; ${subtitle}; ${link}; ${location}; ${detail}`);
                });

                //Get the first feature
                    const feature = featureEvent.features[0];
                    if (!feature) {
                        return;
                    }

                //Add pop-up using mapboxgl
                    const coords = featureEvent.coordinates;
                    const html = `
                        <div style="background-color:rgb(255, 220, 51);border:20px solid rgb(255, 220, 51);">
                            <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;color:rgb(255,255,255)">${feature.variables.title.value}</h1>
                        </div>
                        <div>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:16px;">${feature.variables.subtitle.value}</p1>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Link: <a href="${feature.variables.link.value}" target="_blank">Click here</a></p>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Location: ${feature.variables.location.value}
                        </div>
                    `;
                    new mapboxgl.Popup()
                        .setLngLat([coords.lng, coords.lat])
                        .setHTML(html)
                        .addTo(map);
            });

//Recent Episodes Layer
    // Define source
    const recentSource = new carto.source.Dataset('featured_episodes_layer_2');
    
    //Create visualization for clusters layer 
        const recentVizC = new carto.Viz(`
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: 30
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009180730Recent.svg')
            strokeWidth: 0
            resolution: 32     
        `);

    //Add cluster layer to map    
        const recentLayerC = new carto.Layer('recentC', recentSource, recentVizC);
        recentLayerC.on('loaded', function() {
            if (recentCheckbox.checked == false) {
                recentLayerC.hide();
            }
        });
        recentLayerC.addTo(map);

    //Create visualization for pop-ups layer
        const recentVizP = new carto.Viz(`
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009180730Recent.svg')
            width: 30
            strokeWidth: 0
            resolution: 8
            @currentFeatures: viewportCount()
            @title: $title
            @subtitle: $subtitle
            @link: $link
            @detail: $detail
            @location: $location
        `);
        
    //Add pop-up layer to map
        const recentLayerP = new carto.Layer('recent', recentSource, recentVizP);
        recentLayerP.on('loaded', function() { recentLayerP.hide();});
        recentLayerP.addTo(map);

    //Create pop-up
        const recentinteractivity = new carto.Interactivity(recentLayerP);
            recentinteractivity.on('featureClick', featureEvent => {
                featureEvent.features.forEach((feature) => {
                    const title = feature.variables.title.value;
                    const subtitle = feature.variables.subtitle.value;
                    const link = feature.variables.link.value;
                    const detail= feature.variables.detail.value;
                    const location=feature.variables.location.value;
                    console.log(`${title}; ${subtitle}; ${link}; ${location}; ${detail}`);
                });

            // Get the first feature
                const feature = featureEvent.features[0];
                if (!feature) {
                    return;
                }

            // Add pop-up using mapboxgl
                const coords = featureEvent.coordinates;
                const html = `
                    <div style="background-color:rgb(247, 9, 9); border:20px solid rgb(247, 9, 9);">
                        <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;color:rgb(255,255,255)">${feature.variables.title.value}</h1>
                    </div>
                    <div>
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:16px;">${feature.variables.subtitle.value}</p1>
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Link: <a href="${feature.variables.link.value}" target="_blank">Click here</a></p>
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Location: ${feature.variables.location.value}
                    </div>
                `;
                new mapboxgl.Popup()
                    .setLngLat([coords.lng, coords.lat])
                    .setHTML(html)
                    .addTo(map);
            });

//Articles Layer
    // Define source
        const articleSource = new carto.source.Dataset('article_layer');
        
    //Create visualization for clusters layer 
        const articleVizC = new carto.Viz(`
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: sqrt(clusterCount())*3 + 10
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009193431Article.svg')
            strokeWidth: 0
            resolution: 32
        `);
    
    //Add cluster layer to map
        const articleLayerC = new carto.Layer('articlesC', articleSource, articleVizC);
        articleLayerC.on('loaded', function() {
            if (articleCheckbox.checked == false) {
                articleLayerC.hide();
            }
        });
        articleLayerC.addTo(map);
    
    //Create visualization for pop-ups layer
        const articleVizP = new carto.Viz(`
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009193431Article.svg')
            width: 15
            strokeWidth: 0
            resolution: 8
            @count: clusterCount()
            @title: $title
            @description: $subtitle_description
            @link: $link
            @location: $location_city
        `);
        
    //Add pop-up layer to map
        const articleLayerP = new carto.Layer('articlesP', articleSource, articleVizP);
        articleLayerP.on('loaded', function() { articleLayerP.hide();});
        articleLayerP.addTo(map);

    //Create pop-up
        const articleinteractivity = new carto.Interactivity(articleLayerP);
            articleinteractivity.on('featureClick', featureEvent => {
                featureEvent.features.forEach((feature) => {
                    const title = feature.variables.title.value;
                    const description = feature.variables.description.value;
                    const link = feature.variables.link.value;
                    const location= feature.variables.location.value;
                    console.log(`${title}; ${description}; ${link}; ${location}`);
                });

                //Get the first feature
                    const feature = featureEvent.features[0];
                    if (!feature) {
                        return;
                    }

                //Add pop-up using mapboxgl
                    const coords = featureEvent.coordinates;
                    const html = `
                        <div style="background-color:rgb(60, 166, 247);border:20px solid rgb(60, 166, 247);">
                            <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;color:rgb(255,255,255)">${feature.variables.title.value}</h1>
                        </div>
                        <div>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:16px;">${feature.variables.description.value}</p1>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Link: <a href="${feature.variables.link.value}" target="_blank">Click here</a></p>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Location: ${feature.variables.location.value}
                        </div>
                    `;
                    new mapboxgl.Popup()
                        .setLngLat([coords.lng, coords.lat])
                        .setHTML(html)
                        .addTo(map);
            });

//Video Layer
    // Define source
        const videoSource = new carto.source.Dataset('video_layer_2');
        
    //Create visualization for clusters layer
        const videoVizC = new carto.Viz(`
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: sqrt(clusterCount())*3 + 10
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009181513Video.svg')
            strokeWidth: 0
            resolution: 32
        `);

    //Add cluster layer to map
        const videoLayerC = new carto.Layer('videoC', videoSource, videoVizC);
        videoLayerC.on('loaded', function() {
            if (videoCheckbox.checked == false) {
                videoLayerC.hide();
            }
        });
        videoLayerC.addTo(map);

    //Create visualization for pop-ups layer
        const videoVizP = new carto.Viz(`
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009181513Video.svg')
            width: 15
            strokeWidth: 0
            resolution: 8
            @currentFeatures: viewportCount()
            @title: $title
            @description: $subtitle_description
            @link: $link
            @location: $location
            @attribution: $detail
        `);
        
    //Add pop-up layer to map
        const videoLayerP = new carto.Layer('videoP', videoSource, videoVizP);
        videoLayerP.on('loaded', function() { videoLayerP.hide();});
        videoLayerP.addTo(map);

    //Create pop-up
        const videointeractivity = new carto.Interactivity(videoLayerP);
            videointeractivity.on('featureClick', featureEvent => {
                featureEvent.features.forEach((feature) => {
                    const title = feature.variables.title.value;
                    const description = feature.variables.description.value;
                    const link = feature.variables.link.value;
                    const location= feature.variables.location.value;
                    const attribution= feature.variables.attribution.value;
                    console.log(`${title}; ${description}; ${link}; ${location}; ${attribution}`);
                });

            //Get the first feature
                const feature = featureEvent.features[0];
                if (!feature) {
                    return;
                }

            //Add pop-up using mapboxgl
                const coords = featureEvent.coordinates;
                const html = `
                    <div style="background-color:rgb(104, 27, 221); border:20px solid rgb(104, 27, 221);">
                        <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;color:rgb(255,255,255)">${feature.variables.title.value}</h1>
                    </div>
                    <div>
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:16px;">${feature.variables.description.value}</p1>
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Link: <a href="${feature.variables.link.value}" target="_blank">Click here</a></p>
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Location: ${feature.variables.location.value}
                        <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Attribution: ${feature.variables.attribution.value}
                    </div>
                `;
                new mapboxgl.Popup()
                    .setLngLat([coords.lng, coords.lat])
                    .setHTML(html)
                    .addTo(map);
            });

//English Frequencies Layer
    // Define source
        const englishSource = new carto.source.Dataset('english_frequencies_layer');

    //Create visualization for clusters layer 
        const englishVizC = new carto.Viz(`
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: sqrt(clusterCount())*3 + 10
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009193900English.svg')
            strokeWidth: 0
            resolution: 32
        `);
    
    //Add cluster layer to map
        const englishLayerC = new carto.Layer('englishC', englishSource, englishVizC);
        englishLayerC.on('loaded', function() {
            if (englishCheckbox.checked == false) {
                englishLayerC.hide();
            }
        });        englishLayerC.addTo(map);

    //Create visualization for pop-ups layer
        const englishVizP = new carto.Viz(`
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009193900English.svg')
            width: 15
            strokeWidth: 0
            resolution: 8
            @currentFeatures: viewportCount()
            @station: $station
            @frequency: $frequency
            @air_times_provided: $air_times_provided
            @homepage: $homepage
        `);
        
    //Add pop-up layer to map
        const englishLayerP = new carto.Layer('englishP', englishSource, englishVizP);
        englishLayerP.on('loaded', function() { englishLayerP.hide();});
        englishLayerP.addTo(map);

    //Create pop-up
        const englishinteractivity = new carto.Interactivity(englishLayerP);
            englishinteractivity.on('featureClick', featureEvent => {
                featureEvent.features.forEach((feature) => {
                    const station = feature.variables.station.value;
                    const frequency = feature.variables.frequency.value;
                    const air_times_provided = feature.variables.air_times_provided.value;
                    const homepage= feature.variables.homepage.value;
                    console.log(`${station}; ${frequency}; ${air_times_provided}; ${homepage}`);
                });

                //Get the first feature
                    const feature = featureEvent.features[0];
                    if (!feature) {
                        return;
                    }

                //Add pop-up using mapboxgl
                    const coords = featureEvent.coordinates;
                    const html = `
                        <div style="background-color:rgb(0, 112, 60); border:20px solid rgb(0, 112, 60);">
                            <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;color:rgb(255,255,255)">${feature.variables.station.value}</h1>
                        </div>
                        <div>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:16px;">${feature.variables.frequency.value}</p1>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Link: <a href="${feature.variables.homepage.value}" target="_blank">Click here</a></p>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Air Times Provided: ${feature.variables.air_times_provided.value}
                        </div>
                    `;
                    new mapboxgl.Popup()
                        .setLngLat([coords.lng, coords.lat])
                        .setHTML(html)
                        .addTo(map);
            });

//Spanish Frequencies Layer
    // Define source
        const spanishSource = new carto.source.Dataset('spanish_frequencies_layer');
        
    //Create visualization for clusters layer 
        const spanishVizC = new carto.Viz(`
            @count: clusterCount()
            @v_features: viewportFeatures(@count)
            width: sqrt(clusterCount())*3 + 10
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009181201Spanish.svg')
            strokeWidth: 0
            resolution: 32
        `);

    //Add cluster layer to map    
        const spanishLayerC = new carto.Layer('spanishC', spanishSource, spanishVizC);
        spanishLayerC.on('loaded', function() {
            if (spanishCheckbox.checked == false) {
                spanishLayerC.hide();
            }
        });
        spanishLayerC.addTo(map);

    //Create visualization for pop-ups layer
        const spanishVizP = new carto.Viz(`
            symbol: image('https://s3.amazonaws.com/com.cartodb.users-assets.production/production/yale-climate-connections/assets/20201009181201Spanish.svg')
            width: 15
            strokeWidth: 0
            resolution: 8
            @currentFeatures: viewportCount()
            @station: $station
            @frequency: $frequency
            @program: $program
            @homepage: $homepage
        `);
        
    //Add pop-up layer to map
        const spanishLayerP = new carto.Layer('spanishP', spanishSource, spanishVizP);
        spanishLayerP.on('loaded', function() { spanishLayerP.hide();});
        spanishLayerP.addTo(map);

    //Create pop-up
        const spanishinteractivity = new carto.Interactivity(spanishLayerP);
            spanishinteractivity.on('featureClick', featureEvent => {
                featureEvent.features.forEach((feature) => {
                    const station = feature.variables.station.value;
                    const frequency = feature.variables.frequency.value;
                    const program = feature.variables.program.value;
                    const homepage= feature.variables.homepage.value;
                    console.log(`${station}; ${frequency}; ${program}; ${homepage}`);
                });

                // Get the first feature
                    const feature = featureEvent.features[0];
                    if (!feature) {
                        return;
                    }

                //Add pop-up using mapboxgl
                    const coords = featureEvent.coordinates;
                    const html = `
                        <div style="background-color:rgb(50, 55, 59); border:20px solid rgb(50, 55, 59);">
                            <h1 style = "font-family:Arial, Helvetica, sans-serif;font-size:22px;color:rgb(255,255,255)">${feature.variables.station.value}</h1>
                        </div>
                        <div>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:16px;">${feature.variables.frequency.value}</p1>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Link: <a href="${feature.variables.homepage.value}" target="_blank">Click here</a></p>
                            <p style = "font-family:Arial, Helvetica, sans-serif;font-size:14px;">Program: ${feature.variables.program.value}
                        </div>
                    `;
                    new mapboxgl.Popup()
                        .setLngLat([coords.lng, coords.lat])
                        .setHTML(html)
                        .addTo(map);
            });

//CONSOLE LOG

// Wait for the map to load for the first time
    map.on('load', () => {
        console.log('Map has loaded!');
    });

//Console Updates
    episodesLayerC.on('loaded', () => {
        console.log('Episodes layer has loaded');
    });
    articleLayerC.on('loaded', () => {
        console.log('Article layer has loaded');
    });
    recentLayerC.on('loaded', () => {
        console.log('Recent Episodes layer has loaded');
    });
    videoLayerC.on('loaded', () => {
        console.log('Video layer has loaded');
    });
    englishLayerC.on('loaded', () => {
        console.log('English Frequencies layer has loaded');
    });
    spanishLayerC.on('loaded', () => {
        console.log('Spanish Frequencies layer has loaded');
    });
    carto.on('loaded', [episodesLayerC, articleLayerC, videoLayerC, recentLayerC, englishLayerC, spanishLayerC], () => { console.log('All layers have loaded'); })

//Logging out to make sure we get the checkboxes correctly
    // console.log('radio:', radioCheckbox.checked);
    // console.log('recent:', recentCheckbox.checked);
    // console.log('article:', articleCheckbox.checked);
    // console.log('video:', videoCheckbox.checked);
    // console.log('english:', englishCheckbox.checked);
    // console.log('spanish:', spanishCheckbox.checked);

    map.on('move', handleCheckboxChange);

</script>
</body>
</html>